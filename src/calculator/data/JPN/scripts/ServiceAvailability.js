const { writeFileSync } = require('fs');
const { join } = require('path');
const Fuse = require('fuse.js');
const countryData = require('../../country-iso-names.json');

const searchOptions = {
  shouldSort: true,
  threshold: 0.5,
  keys: ['name'],
};

const zones = {
  'Second Zone': [
    'Afghanistan',
    'India',
    'Indonesia',
    'Vietnam',
    'Cambodia',
    'Singapore',
    'Sri Lanka',
    'Thailand',
    'Nepal',
    'Pakistan',
    'Bangladesh',
    'East Timor',
    'Bhutan',
    'Brunei',
    'Malaysia',
    'Myanmar',
    'Maldives',
    'Laos',
  ],
  'Third Zone': [
    'Aruba',
    'Anguilla',
    'Antigua and Barbuda',
    'El Salvador',
    'Guadeloupe',
    'Canada',
    'Cuba',
    'CuraÃ§ao',
    'Guatemala',
    'Grenada',
    'Cayman Islands',
    'Costa Rica',
    'Jamaica',
    'Sint Maarten',
    'Saint Vincent',
    'Saint Lucia',
    'Dominica',
    'Dominican Republic',
    'Trinidad and Tobago',
    'Nicaragua',
    'Haiti',
    'Panama',
    'Bahamas',
    'Bermuda Islands',
    'Barbados',
    'Belize',
    'Honduras',
    'Martinique',
    'Mexico',
    'Montserrat',
    'United Arab Emirates',
    'Yemen',
    'Israel',
    'Iraq',
    'Iran',
    'Oman',
    'Qatar',
    'Kuwait',
    'Cyprus',
    'Saudi Arabia',
    'Jordan',
    'Syria',
    'Turkey',
    'Bahrain',
    'Lebanon',
    'Iceland',
    'Ireland',
    'Azerbaijan',
    'Albania',
    'Armenia',
    'Andorra',
    'Italy',
    'Vatican',
    'Ukraine',
    'Uzbekistan',
    'Estonia',
    'Austria',
    'Netherlands',
    'Guernsey',
    'Kazakhstan',
    'Macedonia',
    'Greece',
    'Kyrgyz',
    'Georgia',
    'Croatia',
    'Kosovo',
    'San Marino',
    'Gibraltar',
    'Jersey',
    'Switzerland',
    'Sweden',
    'Spain',
    'Slovakia',
    'Slovenia',
    'Tajikistan',
    'Czech Republic',
    'Denmark',
    'Germany',
    'Turkmenistan',
    'Norway',
    'Hungary',
    'Finland',
    'France',
    'Bulgaria',
    'Belarus',
    'Belgium',
    'Poland',
    'Bosnia and Herzegovina',
    'Northern Islands',
    'Portugal',
    'Malta',
    'Monaco',
    'Moldova',
    'Serbia',
    'Latvia',
    'Lithuania',
    'Liechtenstein',
    'Romania',
    'Luxembourg',
    'United Kingdom',
    'Russia',
  ],
  'Fourth Zone': [
    'Argentina',
    'Venezuela',
    'Uruguay',
    'Ecuador',
    'Guyana',
    'Colombia',
    'Surinam',
    'Chile',
    'Paraguay',
    'French Guiana',
    'Falkland Islands',
    'Brazil',
    'Peru',
    'Bolivia',
    'Ascension',
    'Algeria',
    'Angola',
    'Uganda',
    'Egypt',
    'Eswatini',
    'Ethiopia',
    'Eritrea',
    'Ghana',
    'Cape Verde',
    'Gabon',
    'Cameroon',
    'Gambia',
    'Guinea',
    'Guinea-Bissau',
    'Kenya',
    'Comoros',
    'Congo',
    'Congo-Kinshasa',
    'Sao Tome And Principe',
    'Zambia',
    'Sierra Leone',
    'Djibouti',
    'Zimbabwe',
    'Sudan',
    'Seychelles',
    'Equatorial Guinea',
    'Senegal',
    'St. Helena & Dependencies',
    "Cote d'Ivoire",
    'Somalia',
    'Tanzania',
    'Chad',
    'Central African Republic',
    'Tunisia',
    'Togo',
    'Tristan da Cunha',
    'Nigeria',
    'Namibia',
    'Niger',
    'Burkina Faso',
    'Burundi',
    'Benin',
    'Botswana',
    'Madagascar',
    'Malawi',
    'Mali',
    'South African Republic',
    'Mauritius',
    'Mauritania',
    'Mozambique',
    'Morocco',
    'Libya',
    'Liberia',
    'Rwanda',
    'Lesotho',
  ],
};

const fuse = new Fuse(countryData, searchOptions);

const isoEntries = Object.entries(zones).reduce(
  (isoEntries, [zone, countries]) => {
    isoEntries[zone] = countries.reduce((isoCountries, country) => {
      const matches = fuse.search(country);

      if (matches.length === 0) return isoCountries;

      isoCountries.push(matches[0].item['alpha-3']);

      return isoCountries;
    }, []);

    return isoEntries;
  },
  {},
);

writeFileSync(
  join(__dirname, './jpn-service-availability.json'),
  JSON.stringify(isoEntries, null, 2),
  'utf8',
);

